# This is my Hyprland config file. For use with Arch. BTW.
# Machine is Thinkpad X1 Carbon Gen8... Mostly. 
# I don't dock, so idk what monitor settings you need. I have a desktop with different configs.
# My wallpaper choices are all from wallhaven, so I don't know if you want to keep them.

# I have a few custom scripts in ~/.local/bin/ 
# some of them are listed below Wrappers

# Refer to the wiki for more information. Super helpful. 
# https://wiki.hypr.land/Configuring/

# Not all available settings / options are set here.
# For a full list, see the wiki

# You can split this configuration into multiple files. I don't do this.
# Create your files separately and then link them to this file like this: I don't do this either.
# source = ~/.config/hypr/myColors.conf

####################################
### Installed Commands Reference ###
####################################

# These are not configs, these are just reminders for me to recall
# Which commands will launch what. It is not an exhaustive list. Just the ones I use often.
# You may never need these, but I do, from time to time

# brave
# discord
# discord down
# codium  # prefered editor for me
# code  # vscode
# cursor  # ai assisted coding
# easyeffects  # this is for audio
# firefox
# gedit # notepad replacement, txt/md editor
# seahorse # keyring
# slack
# restartwaybar # restarts waybar
# wallpaper-reload # reloads wallpaper, handy if you want to hotswap new backgrounds
# syncup # starts syncthing
# syncdown # stops syncthing
# syncstatus # shows status of syncthing
# killdev # kills dev server


### Helpful commands
# sudo clamscan -r /home/$USER

### configs
### there's a lot, this is just common ones
# ~/.config/waybar/config.jsonc # waybar config
# ~/.config/waybar/style.css # waybar style
# ~/.config/waybar/scripts/power-menu.sh # power menu script
# ~/.config/wofi/style.css # application launcher config
# ~/.config/rofi/hyprland-window.rasi # window overview config
# ~/.config/dunst/dunstrc # notification daemon config
# ~/.config/hypr/hyprlock.conf # lock screen config
# ~/.config/hypr/hyprpaper.conf # wallpaper daemon config
# ~/.config/hypr/hypland.conf # hyprland config
# ~/.config/hypr/hypridle.conf # idle daemon config
# or run ls ~/.config for a better list

################
### Wrappers ###
################

# This is not exhaustive, I am updating as I remember, 
# or as things misbehave. No surprise theey're almost all 
# Electron Apps

# Slack - ~/.local/bin/slack-xwayland
# Cursor - ~/bin/cursor-x11-nogpu
# Discord - ~/.local/bin/discord-wayland
# Notion - ~/.local/bin/notion-xwayland

################
### MONITORS ###
################

# See https://wiki.hypr.land/Configuring/Monitors/
# ThinkPad X1 Carbon Gen8 - adjust if needed. Check with: hyprctl monitors
# actual monitor is eDP-1, if you need it
monitor= eDP-1,preferred,auto,auto

# Keep workspaces persistent (don't empty on close)
workspace = 1, persistent:true
# workspace = 2, persistent:true
# workspace = 3, persistent:true
# workspace = 4, persistent:true
# workspace = 5, persistent:true
# workspace = 6, persistent:true
# workspace = 7, persistent:true
# workspace = 8, persistent:true
# workspace = 9, persistent:true
# workspace = 10, persistent:true


###################
### MY PROGRAMS ###
###################

# See https://wiki.hypr.land/Configuring/Keywords/

# Set programs that you use
$terminal = kitty # don't judge me, I like kitty
$fileManager = thunar # dolphin is the devil, thunar just works and it is my file manager of choice
$menu = wofi --show drun # wofi is my application launcher of choice
$screenshotDir = ~/Pictures/Screenshots

#################
### AUTOSTART ###
#################

# Desktop plumbing
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=Hyprland XDG_SESSION_DESKTOP=Hyprland
exec-once = systemctl --user import-environment DISPLAY WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_DESKTOP PATH

# Polkit agent (needed for NetworkManager auth prompts)
exec-once = ~/.local/bin/start-polkit.sh

# Network + UI
exec-once = nm-applet --indicator
exec-once = waybar
exec-once = dunst
exec-once = hyprpaper

# Browsers
# exec-once = firefox
exec-once = brave

# Messaging
# exec-once = ~/.local/bin/slack-xwayland

# apps
# exec-once = discord
exec-once = evolution

# File manager daemon (for volume auto-mount)
exec-once = thunar --daemon

# Start gnome-keyring
exec-once = ~/.local/bin/start-keyring.sh

# Start EasyEffects
exec-once = easyeffects --gapplication-service

# Start Blueman
exec-once = sleep 2 && blueman-applet

# Idle/lock/suspend (respects Wayland idle-inhibit = no timeouts during video)
exec-once = hypridle

#############################
### ENVIRONMENT VARIABLES ###
#############################

# See https://wiki.hypr.land/Configuring/Environment-variables/

env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24
env = XCURSOR_THEME,Adwaita  # Change to your preferred cursor theme if desired
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = MOZ_ENABLE_WAYLAND,1
env = PATH,$HOME/.local/bin:$PATH
env = NOBLANK_CURSOR,1
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = OZONE_PLATFORM,wayland
env = GDK_SCALE,1  # XWayland app scaling
env = QT_SCALE_FACTOR,1  # XWayland app scaling

###################
### PERMISSIONS ###
###################

# See https://wiki.hypr.land/Configuring/Permissions/
# Please note permission changes here require a Hyprland restart and are not applied on-the-fly
# for security reasons

# ecosystem {
#   enforce_permissions = 1
# }

permission = /usr/(bin|local/bin)/grim, screencopy, allow
permission = /usr/(lib|libexec|lib64)/xdg-desktop-portal-hyprland, screencopy, allow
permission = /usr/(bin|local/bin)/hyprpm, plugin, allow


#####################
### LOOK AND FEEL ###
#####################

# Refer to https://wiki.hypr.land/Configuring/Variables/

# https://wiki.hypr.land/Configuring/Variables/#general
general {
    gaps_in = 3
    gaps_out = 5

    border_size = 2

    # https://wiki.hypr.land/Configuring/Variables/#variable-types for info about colors
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)

    # Set to true enable resizing windows by clicking and dragging on borders and gaps
    resize_on_border = true

    # Please see https://wiki.hypr.land/Configuring/Tearing/ before you turn this on
    allow_tearing = false

    layout = dwindle
}

# https://wiki.hypr.land/Configuring/Variables/#decoration
decoration {
    rounding = 5
    rounding_power = 2

    # Change transparency of focused and unfocused windows
    active_opacity = 0.95
    inactive_opacity = 0.65

    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }

    # https://wiki.hypr.land/Configuring/Variables/#blur
    blur {
        enabled = true
        size = 3
        passes = 1

        vibrancy = 0.1696
    }
}

# https://wiki.hypr.land/Configuring/Variables/#animations
animations {
    enabled = true

    # Default curves, see https://wiki.hypr.land/Configuring/Animations/#curves
    #        NAME,           X0,   Y0,   X1,   Y1
    bezier = easeOutQuint,   0.23, 1,    0.32, 1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear,         0,    0,    1,    1
    bezier = almostLinear,   0.5,  0.5,  0.75, 1
    bezier = quick,          0.15, 0,    0.1,  1

    # Default animations, see https://wiki.hypr.land/Configuring/Animations/
    #           NAME,          ONOFF, SPEED, CURVE,        [STYLE]
    animation = global,        1,     10,    default
    animation = border,        1,     5.39,  easeOutQuint
    animation = windows,       1,     4.79,  easeOutQuint
    animation = windowsIn,     1,     4.1,   easeOutQuint, popin 87%
    animation = windowsOut,    1,     1.49,  linear,       popin 87%
    animation = fadeIn,        1,     1.73,  almostLinear
    animation = fadeOut,       1,     1.46,  almostLinear
    animation = fade,          1,     3.03,  quick
    animation = layers,        1,     3.81,  easeOutQuint
    animation = layersIn,      1,     4,     easeOutQuint, fade
    animation = layersOut,     1,     1.5,   linear,       fade
    animation = fadeLayersIn,  1,     1.79,  almostLinear
    animation = fadeLayersOut, 1,     1.39,  almostLinear
    animation = workspaces,    1,     1.94,  almostLinear, fade
    animation = workspacesIn,  1,     1.21,  almostLinear, fade
    animation = workspacesOut, 1,     1.94,  almostLinear, fade
    animation = zoomFactor,    1,     7,     quick
}

# Ref https://wiki.hypr.land/Configuring/Workspace-Rules/
# "Smart gaps" / "No gaps when only"
# uncomment all if you wish to use that.
# workspace = w[tv1], gapsout:0, gapsin:0
# workspace = f[1], gapsout:0, gapsin:0
# windowrule = bordersize 0, floating:0, onworkspace:w[tv1]
# windowrule = rounding 0, floating:0, onworkspace:w[tv1]
# windowrule = bordersize 0, floating:0, onworkspace:f[1]
# windowrule = rounding 0, floating:0, onworkspace:f[1]

# See https://wiki.hypr.land/Configuring/Dwindle-Layout/ for more
dwindle {
    pseudotile = true # Master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
    preserve_split = true # You probably want this
}

# See https://wiki.hypr.land/Configuring/Master-Layout/ for more
master {
    new_status = master
}

# https://wiki.hypr.land/Configuring/Variables/#misc
misc {
    force_default_wallpaper = 0 # Set to 0 or 1 to disable the anime mascot wallpapers
    disable_hyprland_logo = true # If true disables the random hyprland logo / anime girl background. :(
    enable_swallow = true  # Allow terminal to "swallow" launched programs
    swallow_regex = ^(kitty)$  # Terminal class that can swallow programs
    disable_splash_rendering = true  # Disable splash text for security
    focus_on_activate = true
}


#############
### INPUT ###
#############

# https://wiki.hypr.land/Configuring/Variables/#input
input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =

    follow_mouse = 1

    # -1.0 - 1.0, 0 means no modification.
    sensitivity = 0

    # Keyboard repeat settings
    repeat_rate = 25
    repeat_delay = 600

    touchpad {
        natural_scroll = true
        tap-to-click = true
        disable_while_typing = true
    }
}

# See https://wiki.hypr.land/Configuring/Gestures
# gesture = 3, horizontal, workspace
# gestures {
# 	workspace_swipe = on
# 	workspace_swipe_fingers = 3
# 	workspace_swipe_distance = 300
# 	workspace_swipe_invert = false
# }

# Example per-device config
# See https://wiki.hypr.land/Configuring/Keywords/#per-device-input-configs for more
# Uncomment and adjust device name for your new machine. Check with: hyprctl devices
# device {
#     name = epic-mouse-v1
#     sensitivity = -0.5
# }


###################
### KEYBINDINGS ###
###################

# Main modifier
$mainMod = SUPER  # "Windows" key

###############################################################################
# CORE WINDOW MANAGER CONTROLS
###############################################################################

bind = $mainMod, E, exec, $fileManager
bind = $mainMod, F, fullscreen, 0
bind = $mainMod SHIFT, F, fullscreen, 1
bind = $mainMod, J, togglesplit,   # dwindle
bind = $mainMod, L, exec, hyprlock >/dev/null 2>&1 &
bind = $mainMod, M, exit
bind = $mainMod, P, pseudo        # dwindle
bind = $mainMod, Q, killactive
bind = $mainMod SHIFT, Q, exec, $HOME/.local/bin/kill-app
bind = $mainMod, R, exec, $menu
bind = $mainMod, RETURN, exec, $terminal
bind = $mainMod, V, togglefloating

##############################################################################
# WIndow switch / Overview / Glance
##############################################################################
# Window overview (all windows, all workspaces)
$windowMenu = rofi -show window -modi window -show-icons -theme ~/.config/rofi/hyprland-window.rasi

bind = SUPER, TAB, exec, $windowMenu

# Quick toggle between current and last focused window
# bind = SUPER, GRAVE, exec, hyprswitch simple --sort-recent

###############################################################################
# APP LAUNCHERS
###############################################################################

# ws1: Brave
bind = $mainMod, B, exec, brave --new-window

# ws2: Firefox
bind = $mainMod, X, exec, firefox --new-window

# ws3: Evolution (email)
bind = $mainMod, G, exec, evolution

# ws4: Cursor AI CDI
bind = $mainMod, grave, exec, ~/bin/cursor-x11-nogpu

# ws6: Notion (XWayland wrapper)
bind = $mainMod, N, exec, ~/.local/bin/notion-xwayland

# ws7: Discord (Gen-Chat)
bind = $mainMod, D, exec, discord

# ws8: Slack (work-chat wrapper)
bind = $mainMod, C, exec, $HOME/.local/bin/slack-xwayland

# Obsidian notes (AppImage) active-workspace
bind = $mainMod, O, exec, ~/Applications/Obsidian.AppImage

# TUI network fallback
bind = $mainMod, K, exec, kitty -e nmtui

###############################################################################
# SCREENSHOTS
###############################################################################

# Screenshot full screen
bind = SUPER, PRINT, exec, sh -c 'DIR="$HOME/Pictures/Screenshots"; mkdir -p "$DIR"; grim "$DIR/screenshot-$(date +%Y-%m-%d_%H-%M-%S).png"'

# Screenshot selection  SUPER+SHIFT+PRINT
bind = SUPER+SHIFT, PRINT, exec, sh -c 'DIR="$HOME/Pictures/Screenshots"; mkdir -p "$DIR"; FILE="$DIR/Screenshot_$(date +%Y-%m-%d_%H-%M-%S).png"; grim -g "$(slurp)" - | tee "$FILE" | wl-copy'

# Screenshot active window – SUPER+CTRL+PRINT
bind = SUPER+CTRL, PRINT, exec, sh -c 'DIR="$HOME/Pictures/Screenshots"; mkdir -p "$DIR"; FILE="$DIR/Window_$(date +%Y-%m-%d_%H-%M-%S).png"; grim -g "$(hyprctl activewindow -j | jq -r '"'"'.at,.size | "\(.[0]),\(.[1]) \(.[2])x\(.[3])"'"'")" - | tee "$FILE" | wl-copy'

###############################################################################
# NETWORK / RESCUE
###############################################################################

# One-touch Wi-Fi rescue (needs polkit; will ask for password)
bind = $mainMod, W, exec, pkexec sh -c 'modprobe -r mwifiex_pcie mwifiex; modprobe mwifiex_pcie; systemctl restart NetworkManager'

###############################################################################
# FOCUS & NAVIGATION
###############################################################################

# Move focus with mainMod + arrow keys
bind = $mainMod, left,  movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up,    movefocus, u
bind = $mainMod, down,  movefocus, d

# Resize windows
bind = $mainMod SHIFT, left,  resizeactive, -50 0
bind = $mainMod SHIFT, right, resizeactive, 50 0
bind = $mainMod SHIFT, up,    resizeactive, 0 -50
bind = $mainMod SHIFT, down,  resizeactive, 0 50

# Move windows
bind = $mainMod CTRL, left,  movewindow, l
bind = $mainMod CTRL, right, movewindow, r
bind = $mainMod CTRL, up,    movewindow, u
bind = $mainMod CTRL, down,  movewindow, d

###############################################################################
# WORKSPACES
###############################################################################

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Special workspace (scratchpad)
bind = $mainMod, S, togglespecialworkspace, magic
bind = $mainMod SHIFT, S, movetoworkspace, special:magic

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up,   workspace, e-1

###############################################################################
# MOUSE BINDINGS
###############################################################################

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

###############################################################################
# MEDIA & BRIGHTNESS KEYS
###############################################################################

# Volume + mic mute
bindel = ,XF86AudioRaiseVolume, exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = ,XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = ,XF86AudioMute,        exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = ,XF86AudioMicMute,     exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

# Screen brightness
bindel = ,XF86MonBrightnessUp,   exec, brightnessctl -e4 -n2 set 5%+
bindel = ,XF86MonBrightnessDown, exec, brightnessctl -e4 -n2 set 5%-

# Media controls (requires playerctl)
bindl = ,XF86AudioNext,  exec, playerctl next
bindl = ,XF86AudioPause, exec, playerctl play-pause
bindl = ,XF86AudioPlay,  exec, playerctl play-pause
bindl = ,XF86AudioPrev,  exec, playerctl previous


##############################
### WINDOWS AND WORKSPACES ###
##############################

# See https://wiki.hypr.land/Configuring/Window-Rules/ for more
# See https://wiki.hypr.land/Configuring/Workspace-Rules/ for workspace rules

# Brave → workspace 1
windowrule = match:class ^(brave-browser)$, workspace 1

# Firefox → workspace 2
windowrule = match:class ^(firefox)$, workspace 2

# Evolution → workspace 3
windowrule = match:class ^(org\.gnome\.Evolution)$, workspace 3

# Cursor → workspace 4
windowrule = match:class ^(Cursor)$, workspace 4

# VSCodium → workspace 5
windowrule = match:class ^(codium)$, workspace 5

# Notion → workspace 6
windowrule = match:class ^(notion-electron-linux)$, workspace 6

# Discord → workspace 7
windowrule = match:class ^(discord)$, workspace 7

# Slack → workspace 8
windowrule = match:class ^(Slack)$, workspace 8

###############################################################################
# FLOATING / WINDOW BEHAVIOR RULES HYPRLAND 0.53 (UPDATED)
###############################################################################

# Floating windows should never start maximized/fullscreen
windowrule = match:float true, fullscreen_state 0 0
windowrule = match:float true, maximize off
windowrule = match:float true, fullscreen off

# Block client-driven maximize/fullscreen events for floating windows
windowrule = match:float true, suppress_event maximize
windowrule = match:float true, suppress_event fullscreen

# Default float geometry
windowrule = match:float true, size 60% 70%
windowrule = match:float true, center on

# Cursor → fullscreen + opaque
windowrule = match:class ^(Cursor)$, fullscreen on
windowrule = match:class ^(Cursor)$, opaque on

# Discord → float + center + size
windowrule = match:class ^(discord)$, float on
windowrule = match:class ^(discord)$, size 900 500
windowrule = match:class ^(discord)$, center on

# VSCodium → fullscreen + opaque
windowrule = match:class ^(codium)$, fullscreen on
windowrule = match:class ^(codium)$, opaque on

# Obsidian → float + center + size
windowrule = match:class ^(obsidian)$, float on
windowrule = match:class ^(obsidian)$, size 800 600
windowrule = match:class ^(obsidian)$, center on

# Notion → float + center + opaque + size
windowrule = match:class ^(notion-electron-linux)$, float on
windowrule = match:class ^(notion-electron-linux)$, size 900 500
windowrule = match:class ^(notion-electron-linux)$, center on
windowrule = match:class ^(notion-electron-linux)$, opaque on

# Center all floating windows
windowrule = match:float 1, center 1

###############################################################################
# FLOATING DIALOG RULES
###############################################################################

# Utilities
windowrule = match:class ^(org\.pulseaudio\.pavucontrol)$, float on
windowrule = match:class ^(org\.pulseaudio\.pavucontrol)$, center on
windowrule = match:class ^(blueman-manager)$, float on
windowrule = match:class ^(nm-connection-editor)$, float on

# Common dialog-ish classes — normalize
windowrule = match:class ^(dialog|confirm|error|notification|splash|confirmreset)$, size 900 600
windowrule = match:class ^(dialog|confirm|error|notification|splash|confirmreset)$, center on
windowrule = match:class ^(dialog|confirm|error|notification|splash|confirmreset)$, float on

# File pickers / dialogs by title
windowrule = match:title ^(Open File)(.*)$, float on
windowrule = match:title ^(Select a File)(.*)$, float on
windowrule = match:title ^(Choose wallpaper)(.*)$, float on
windowrule = match:title ^(Open Folder)(.*)$, float on

###############################################################################
# GLOBAL RULES (APPLY TO EVERYTHING)
###############################################################################

# Ignore maximize requests from apps
windowrule = match:float true, suppress_event maximize

# Fix XWayland dragging issues / ghost windows
windowrule = match:xwayland true, match:class ^$, match:title ^$, no_focus on
